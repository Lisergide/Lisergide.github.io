"use strict";class Cart{constructor(t,a=".shop_cart"){this.source=t,this.container=a,this.amount=0,this.basketItems=[],this._init(this.source)}_render(){let t=$(".cart_grid_container"),a=$("<div/>",{class:"grid_col_wrapper"});a.appendTo(t),a.append($('<div class="shop_cart_t">Product Details</div>')),a.append($('<div class="shop_cart_t">unite Price</div>')),a.append($('<div class="shop_cart_t">Quantity</div>')),a.append($('<div class="shop_cart_t">shipping</div>')),a.append($('<div class="shop_cart_t">Subtotal</div>')),a.append($('<div class="shop_cart_t">ACTION</div>'))}_init(t){if(this._render(),localStorage.getItem("myitems")){this.basketItems=JSON.parse(localStorage.getItem("myitems")),this.amount=JSON.parse(localStorage.getItem("amount"));for(let t of this.basketItems)this._renderItem(t),this._updateCart(t);this._renderSum()}else fetch(t).then(t=>t.json()).then(t=>{for(let a of t.contents)this.basketItems.push(a),this._renderItem(a);this.amount=t.amount,localStorage.setItem("myitems",JSON.stringify(this.basketItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),this._renderSum()})}_renderItem(t){let a=$("<div/>",{class:"grid_col_wrapper","data-product":t.id_product}),e=$("<div/>",{class:"td_img"}),i=$("<a/>",{class:"shop_cart_table_img",href:"single_page.html"}),s=$(`<img src=${t.img} alt="shop_cart_img" class="shop_cart_img">`),n=$(`<a href="single_page.html" class="item_table_title">${t.product_name}</a><br>`),d=$('<span class="item_spec_info">Color: <span>Red</span></span><br>'),r=$('<span class="item_spec_info">Size: <span>Xll</span></span>');e.appendTo(a),i.appendTo(e),s.appendTo(i),n.appendTo(e),d.appendTo(e),r.appendTo(e),a.append($(`<div class="td_unite_price">$${t.price}</div>`));let p=$("<div/>",{class:"td_quantity"});p.appendTo(a),p.append($(`<input id="quantity" type="number" name="quantity" data-id="${t.id_product}" class="td_quality_ink" value="${t.quantity}" min="1" max="100">`)),a.append($('<div class="td_shipping">FREE</div>')),a.append($(`<div class="td_subtotal" data-id="${t.id_product}">$${t.price*t.quantity}</div>`));let o=$("<div/>",{class:"td_action"});a.append(o),o.append($('<a><i class="fas fa-times-circle"></i></a>')),o.click(()=>{this._remove(t.id_product)}),a.appendTo($(".cart_grid_container")),this._targetQuantity()}_targetQuantity(){$("input#quantity").on("input",t=>{this._updateSubtotal($(t.target).data("id"),t.target.value)})}_updateSubtotal(t,a){let e=this.basketItems.find(a=>a.id_product===t);e&&(e.quantity<a?(e.quantity++,this.amount+=e.price):(e.quantity--,this.amount-=e.price),this._updateCart(e),this._renderSum())}_renderSum(){$(".total_title").text(`Sub total $${this.amount}`);let t=$(".grand_total");t.text("GRAND TOTAL "),t.append(`<span>$${this.amount}</span>`);let a=$(".cart-total");a.text("TOTAL "),a.append(`<span>$${this.amount}</span>`)}addProduct(t){let a=+$(t).data("id"),e=this.basketItems.find(t=>t.id_product===a);if(e)e.quantity++,this.amount+=e.price,this._updateCart(e);else{let e={id_product:a,price:+$(t).data("price"),product_name:$(t).data("name"),img:$(t).data("img"),quantity:1};this.basketItems.push(e),console.log(this.basketItems),this.amount+=e.price,this._renderItem(e)}localStorage.setItem("myitems",JSON.stringify(this.basketItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),this._renderSum()}_updateCart(t){let a=$(`div[data-product="${t.id_product}"]`);a.find(".cart-price").text(`${t.quantity} x $${t.price}`),a.find(".td_subtotal").text(`$${t.price*t.quantity}`)}_remove(t){let a=this.basketItems.find(a=>a.id_product===t);if(a){this.amount-=a.price*a.quantity;let e=$(`div[data-product="${t}"]`);this.basketItems.splice(this.basketItems.indexOf(a),1),e.remove(),localStorage.setItem("myitems",JSON.stringify(this.basketItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),this._renderSum()}}clearCart(t){$("div[data-product]").remove(),$(".total_title").text("Sub total $0");let a=$(".grand_total");a.text("GRAND TOTAL "),a.append("<span>$0</span>");let e=$(".cart-total");e.text("TOTAL "),e.append("<span>$0</span>"),localStorage.clear()}}