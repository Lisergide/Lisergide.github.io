"use strict";class Feedback{constructor(e,t="#feedback",a="#feedbackForm"){this.source=e,this.container=t,this.form=a,this.feedbackArr=[],this.curID=0,this._init(this.source),this._renderForm(this.form)}_init(e){if(localStorage.getItem("myfeed")){this.feedbackArr=JSON.parse(localStorage.getItem("myfeed"));for(let e of this.feedbackArr)this._renderFeedback(e);this._initForm()}else fetch(e).then(e=>e.json()).then(e=>{this.curID=e.maxID;for(let t of e.comments)this.feedbackArr.push(t),this._renderFeedback(t);localStorage.setItem("myfeed",JSON.stringify(this.feedbackArr)),this._initForm()})}_renderForm(e){let t=$("<button/>",{type:"submit",id:"addFeedback",value:"Add Feedback",text:"Add Feedback"}),a=$("<form/>",{action:"",method:"post",id:"feedback-form"}),d=$("<label/>",{for:"author"}),r=$("<input/>",{type:"text",name:"author",id:"author",class:"feedbackForm_author",placeholder:"Name"}),i=$("<label/>",{for:"text"}),s=$("<textarea/>",{name:"text",id:"text",class:"feedbackForm_msg",placeholder:"Comments"}),o=$("<button/>",{type:"submit",id:"btnSubmit",value:"Send Feedback",text:"Send Feedback"});$(e).append(t),d.appendTo(a),r.appendTo(d),i.appendTo(a),s.appendTo(i),o.appendTo(a),$(e).append(a),$("#feedback-form").hide(),$("#addFeedback").on("click",()=>{$("#feedback-form").show(100),$("#addFeedback").hide(100)}),$("#btnSubmit").on("click",()=>{$("#feedback-form").hide(100),$("#addFeedback").show(100)})}_initForm(){$(this.form).submit(e=>{if(e.preventDefault(),!$("#author").val()||!$("#text").val())return;let t={id:++this.curID,author:$("#author").val(),text:$("#text").val(),approved:!1};this.feedbackArr.push(t),this._renderFeedback(t)})}_renderFeedback(e){let t=$("<div>",{class:"feedbackItem","data-feedback":e.id}),a=$('<button class="dltBtn"><i class="fas fa-times-circle"></i></button>');if(t.append(a),a.click(()=>{this._remove(e.id)}),t.append($(`<p class="author">${e.author}</p>`)),t.append($(`<p class="text">${e.text}</p>`)),e.approved)t.addClass("approved");else{let a=$('<button class="approve-btn"><i class="fas fa-check"></i></button>');t.append(a),t.addClass("not-approved"),a.click(()=>{this._approve(e.id)})}$(this.container).append(t)}_approve(e){let t=this.feedbackArr.find(t=>t.id===e);$(`div[data-feedback="${e}"]`).addClass("approved").removeClass("not-approved").find(".approve-btn").remove(),t.approved=!0,localStorage.setItem("myfeed",JSON.stringify(this.feedbackArr))}_remove(e){let t=this.feedbackArr.find(t=>t.id===e);this.feedbackArr.splice(this.feedbackArr.indexOf(t),1),$(`.feedbackItem[data-feedback="${e}"]`).remove(),localStorage.setItem("myfeed",JSON.stringify(this.feedbackArr))}}